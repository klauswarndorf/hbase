<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <bean id="bindyDataformat"
        class="org.apache.camel.dataformat.bindy.csv.BindyCsvDataFormat">
        <constructor-arg value="com.yoc.mte.hbase" />
    </bean>

    <bean id="viewdata" class="com.yoc.mte.hbase.ViewAdTechImpl" />

    <camelContext trace="true"
        xmlns="http://camel.apache.org/schema/spring">

        <route id="getWebdavSource">
            <from uri="timer:test?repeatCount=1" />
            <to
                uri="http4://sgsdata.adtech.de/yoc/yoc_ekv_20130718.csv?authUsername=yoc&amp;authPassword=Ticani-X75" />
            <split streaming="true">
                <tokenize token="\n" />
                <choice>
                    <when>
                        <simple>${property.CamelSplitIndex} > 0</simple>
                        <to uri="direct:unmarshal" />
                    </when>
                </choice>
            </split>
        </route>

        <route id="unmarshalCSV">
            <from uri="direct:unmarshal" />
            <unmarshal ref="bindyDataformat" />
            <to uri="direct:hbase" />
        </route>

        <route id="writeHbase">
            <from uri="direct:hbase" />

            <!-- <to uri="bean:viewdata" /> -->
            <log message="Log: ${body}" />

            <setHeader headerName="CamelHBaseRowId">
                <el>${in.body.id}</el>
<!--                 <constant>3</constant> -->
            </setHeader>
            <setHeader headerName="CamelHBaseFamily">
                <constant>cf</constant>
            </setHeader>
            <setHeader headerName="CamelHBaseQualifier">
                <constant>sequenceid</constant>
            </setHeader>
            <setHeader headerName="CamelHBaseValue">
<!--                 <el>${body}</el> -->
                <constant>test</constant>
            </setHeader>


            <setHeader headerName="CamelHBaseRowId2">
                <el>${in.body.id}</el>
<!--                 <constant>3</constant> -->
            </setHeader>
            <setHeader headerName="CamelHBaseFamily2">
                <constant>cf</constant>
            </setHeader>
            <setHeader headerName="CamelHBaseQualifier2">
                <constant>plcNetworkId</constant>
            </setHeader>
            <setHeader headerName="CamelHBaseValue2">
<!--                 <el>${in.body.plcNetworkId}</el> -->
                <constant>test2</constant>
            </setHeader>

            <to uri="hbase:mytable?operation=CamelHBasePut" />
        </route>

    </camelContext>



</beans>
